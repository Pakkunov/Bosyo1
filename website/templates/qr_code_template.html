{% extends "main.html" %}

<head>
{% block title %}Profile Page{% endblock title %}
{% block content %}


{% comment %} ----------------------------------------------------------- {% endcomment %}
{% comment %} This page is the QR CODE Scanner for the Employee Attendance {% endcomment %}
{% comment %} ----------------------------------------------------------- {% endcomment %}
{% comment %} this is the template page. navigate to the other to change settings. {% endcomment %}
{% comment %} ----------------------------------------------------------- {% endcomment %}



{% include 'sidebar.html' %}

  <title>Truck List</title>
  <meta name="description" content="List of Trucks">
  <meta name="keywords" content="Truck List">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script type="text/javascript" src="instascan.min.js"></script>
  {% load static %}
  <link rel="stylesheet" href="{% static '/css/qr_code_templatestyle.css' %}">
  <link rel="stylesheet" href="{% static '/css/staffpagestyle.css' %}">

</head>

<style data-tag="default-style-sheet">
    html {
      font-family: Inter;
    }
  
  
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap');
  
  
  </style>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"
    data-tag="font"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
    data-tag="font"
  />
  <!--This is the head section-->
  <!-- <style> ... </style> -->
  </head>
  
  <style>
    .alert {
    width: 58%;
  }
  
  
  </style>
<body class="
--bs-primary: #008751;
--bs-primary-rgb: 0, 135, 81;
--bs-secondary: #1f1f1f;
--bs-secondary-rgb: 31, 31, 31;
--bs-success: #31f99d;
--bs-success-rgb: 49, 249, 157;">


{% comment %} This page is the Attendance Time-in {% endcomment %}

{% if messages %}
<div class="alert alert-danger mt-4" role="alert" style="width: 80%;" id="wrapper">
    <div class="messages">
        {% for message in messages %}
        {{ message }}
        {% endfor %}
    </div>
</div>
{% endif %}
<section class="dashboard-section">
    <div class="container dashboard-container">
      {% comment %} Row Dashboard {% endcomment %}
        <div class="row">
          <div class="col-10 dashboard-content">
            <h1 class="fw-bold">
                Attendance Time-in
            </h1>               
            <h6 style="text-shadow: 2px 2px 3px #656565; margin-top: 40px;">
                Please upload or show your QR Code to log your attendance.
                The QR Codes will be handed over to you by your administrator.
            </h6>
          </div>
        </div>
      </div>
    </div>
</section>

<section>
    <div class="container">
        <div class="row">
            <div class="col my-5" style="display: flex; align-items: center; justify-content: center;">
                <div id="qr-reader" style="width: 900px; border-radius: 20px;"></div>
            </div>
            <div class="row">
                <div class="col">
                    <div id="qr-reader-results" style="display: flex; align-items: center; justify-content: center;">
                        <form method="post">
                        {% csrf_token %}
                            <input type="text" name="decodedText" id="decodedText" readonly="" class="form-control my-5">
                        </form>
                    </div>
                <div>
            </div>
            <div class="row" style="padding: 10px; display: flex; align-items: center; justify-content: center;">
                <div class="col-10 mb-5" style="border-radius: 20px; background: #fff;">
                    <table class="table text-dark">
                        <thead class="text-center">
                            <tr>
                            <th>Name</th>
                            <th>Time-In</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            {% comment %} backend {% endcomment %}
                            {% for user in attendance|slice:"::-1" %}  
                            {% if forloop.counter < 11  %}
                            <tr>
                                <td>{{user.helper}}</td>
                                <td>{{user.attendance_time}}</td>
                            {% endif %} 
                            </tr>
                            {% endfor %} 
                            </tbody>
                    </table>
                </div>
            </div>
            <script>
                var resultContainer = document.getElementById('qr-reader-results');
                var lastResult, countResults = 0;

                function onScanSuccess(decodedText, decodedResult) {
                    if (decodedText !== lastResult) {
                        ++countResults;
                        lastResult = decodedText;
                        // Handle on success condition with the decoded message.
                        console.log(`Scan result ${decodedText}`, decodedResult);
                        document.getElementById("decodedText").value=decodedText
                        document.forms[0].submit();

                    }
                }
                var html5QrcodeScanner = new Html5QrcodeScanner(
                    "qr-reader", { fps: 10, qrbox: 250 });
                html5QrcodeScanner.render(onScanSuccess);
            </script>
            </div>
        </div>
    </div>
</div>
            
    

        
</section>


<section>
    
</section>

</body>

{% endblock content %}