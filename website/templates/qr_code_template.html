{% extends "main.html" %}

<head>
{% block title %}Profile Page{% endblock title %}
{% block content %}


{% comment %} ----------------------------------------------------------- {% endcomment %}
{% comment %} This page is the QR CODE Scanner for the Employee Attendance {% endcomment %}
{% comment %} ----------------------------------------------------------- {% endcomment %}
{% comment %} this is the template page. navigate to the other to change settings. {% endcomment %}
{% comment %} ----------------------------------------------------------- {% endcomment %}



{% include 'sidebar.html' %}

  <title>Truck List</title>
  <meta name="description" content="List of Trucks">
  <meta name="keywords" content="Truck List">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script type="text/javascript" src="instascan.min.js"></script>
  {% load static %}
  <link rel="stylesheet" href="{% static '/css/qr_code_templatestyle.css' %}">

</head>

<body class="
--bs-primary: #008751;
--bs-primary-rgb: 0, 135, 81;
--bs-secondary: #1f1f1f;
--bs-secondary-rgb: 31, 31, 31;
--bs-success: #31f99d;
--bs-success-rgb: 49, 249, 157;">


{% comment %} This page is the Attendance Time-in {% endcomment %}

{% if messages %}
<div class="alert alert-danger mt-4" role="alert" style="width: 80%;" id="wrapper">
    <div class="messages">
        {% for message in messages %}
        {{ message }}
        {% endfor %}
    </div>
</div>
{% endif %}

{% comment %} Bosyo Home Logo {% endcomment %}
<section style="margin-left: 100px; margin-top: 20px;">
    <a href="{% url 'home'%}">
      <picture id="logo">
        <img
          src="\static\images\BosyoLogoClear.png"
          class="py-1 d-none d-lg-block mx-5"
          style="width: 174px; margin: 0px; padding: 0px">
        </picture>
    </a>
  </section>

<section>
    <div class="container">
        <div class="row">
            <div class="col w-50">
                <div class="col-xl-4 qrlogs">
                    <h1 class="pt-5" style="font-family: 'Montserrat', sans-serif;"><span class="servicesUnderline2">Attendance Time-in</span></h1>
                    <h6 class="mt-3">
                        Please <span class="fw-bold">upload or show your QR Code</span> to log your attendance.
                        <br><br>QR Codes will be provided to you.
                    </h6>
                </div>
            </div>
        </div>
    </div>
</section>

<section>
    <div class="container">
        <div class="row">
            <div class="col my-5" style="padding: 10px; display: flex; align-items: center; justify-content: center;">
                <div id="qr-reader" style="width: 500px; border-radius: 20px;"></div>
            </div>
            <div class="row">
                <div class="col ms-3">
                    <div id="qr-reader-results" style="padding: 10px; display: flex; align-items: center; justify-content: center;">
                        <form method="post">
                        {% csrf_token %}
                            <input type="text" name="decodedText" id="decodedText" readonly="" class="form-control my-5">
                        </form>
                    </div>
                <div>
            </div>
            <div class="row" style="padding: 10px; display: flex; align-items: center; justify-content: center;">
                <div class="col-md-6 col-lg-6" style="border-radius: 20px; background: #171717; color: white;">
                    <table class="table">
                        <thead class="text-light text-center">
                            <tr>
                            <th>Name</th>
                            <th>Time-In</th>
                            </tr>
                        </thead>
                        <tbody class="text-light text-center">
                            {% comment %} backend {% endcomment %}
                            {% for user in attendance|slice:"::-1" %}  
                            {% if forloop.counter < 11  %}
                            <tr>
                                <td>{{user.name}}</td>
                                <td>{{user.attendace_time}}</td>
                            {% endif %} 
                            </tr>
                            {% endfor %} 
                            </tbody>
                    </table>
                </div>
            </div>
            <script>
                var resultContainer = document.getElementById('qr-reader-results');
                var lastResult, countResults = 0;

                function onScanSuccess(decodedText, decodedResult) {
                    if (decodedText !== lastResult) {
                        ++countResults;
                        lastResult = decodedText;
                        // Handle on success condition with the decoded message.
                        console.log(`Scan result ${decodedText}`, decodedResult);
                        document.getElementById("decodedText").value=decodedText
                        document.forms[0].submit();

                    }
                }
                var html5QrcodeScanner = new Html5QrcodeScanner(
                    "qr-reader", { fps: 10, qrbox: 250 });
                html5QrcodeScanner.render(onScanSuccess);
            </script>
            </div>
        </div>
    </div>
</div>
            
    

        
</section>


<section>
    
</section>

</body>

{% endblock content %}